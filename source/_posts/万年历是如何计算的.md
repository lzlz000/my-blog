---
title: 万年历是如何计算的
date: 2019-07-01 14:17:43
tags: [探索与发现 , python]
typora-root-url: ../
---

一份万年历应该包含的内容有公历公元纪年、日期、星期；农历干支纪年、日期，以及公历日期节日、农历节日。

本文主要写的是以一个给定的公历日期来查询星期，农历日期，至于节日，完全可以根据给定的公里农历日期查表获得，例如

```python
# 公历节日 *表示放假日
solar_festival = ["0101*元旦","0214 情人节","0308 妇女节","0312 植树节","0315 消费者权益日","0401 愚人节","0501 劳动节","0504 青年节","0512 护士节","0601 儿童节","0701 建党节","0801 建军节","0808 父亲节","0909 ***逝世纪念","0910 教师节","0928 孔子诞辰","1001*国庆节","1006 老人节","1024 联合国日","1112 孙中山诞辰","1220 澳门回归","1225 圣诞节","1226 ***诞辰"]
# 农历节日 *表示放假日
lunar_festival = ["0101*农历春节","0115 元宵节","0505 端午节","0707 七夕情人节","0815 中秋节","0909 重阳节","1208 腊八节","1224 小年","0100*除夕"]
# 某月的第几个星期几定义的节日
month_week_festival =["05020 母亲节", "06030 母亲节"]
```



至于宜忌，(・∀・(・∀・(・∀・*)，我觉得我写的是一篇科普向的文章，封建迷信就算了吧，据我所知，程序对这种内容八成是随机生成的，或者爬黄历网站的数据，然而还有人相信，权当自我安慰吧。

### 公历
公历是一种太阳历，即以地球绕日公转为基础制定的历法。以地球自转一周为一天，一年有365.2422天（一年的定义有回归年）。

#### 闰年

为了弥补自传和公转的插值，保证每一年的同一天地球在公转轨道上的位置大致相同（否则会出现今年的12月冬天，500年后成了夏天的奇怪情况），就产生了闰年，其规则为每400年有97个闰年，四年一闰，百年不闰，四百年再闰。用代码来表达:

```python
# 判断公元纪年是否为闰年
def is_leap_year(year:int):
    if year % 4 == 0:
        if year % 100 == 0 and year % 400 == 0:
                return True
        elif year % 100 != 0:
            return True
    return False
```

#### 星期

**蔡勒（Zeller）公式** 是一个计算星期的公式，是一个简化星期的计算的技巧，给出一个日期，就能用这个公式推算出是星期几。

```python
def zeller(year: int, month: int, day: int):
    """
    蔡勒公式,计算指定年月日是星期几的算法

    :param year:  年
    :param month: 月
    :param day:   日
    :return: 星期； w对7取模得：0-星期日，1-星期一，2-星期二，3-星期三，4-星期四，5-星期五，6-星期六
    """
    # 在蔡勒公式中，某年的1、2月要看作上一年的13、14月来计算，比如2019年1月1日要看作2018年的13月1日来计算
    if month < 3:
        m = month + 12
        year = year - 1
        if 
    else:
        m = month
    y = year % 100  # 取年的后两位
    # 世纪 取已经经过的世纪，即20xx取20而不是21世纪
    c = (year - y) / 100
    # 注意，如果年份是公元前的年份且非整百数的话，c应该等于所在世纪的编号，如公元前253年，是公元前3世纪
    if c < 0 and y != 0:
        c -= 1
    return (y + int(y/4)+int(c/4)-2*c+int(26*(m+1)/10)+day-1)%7
```

### 农历

农历是混合历，日期记录以月亮历为基础，月球绕地公转周期约29.53059日，因此农历有大小月之分，大月30天小月29天。

#### 农历日期

农历实际上没有非常强的规律性，它的定义是依赖天文观测值推算的，因此通常存储当前前后一百多年的观测/推算值作为农历数据，对于更远的年份采用估算，当然就不是很准确。

个人认为，这其实就是中国传统天文历法的缺陷性，没有追求对天体规律的研究，观测只是手段，而把天象当作凶吉之兆，真是非常可惜的。要知道，西方文明对于天体运动的精确观测和规律的研究对牛顿提出万有引力定律和力学定律产生了直接的影响（再说牛顿被苹果砸想出万有引力定律的拖出去枪毙五分钟），从此我们知道了天上的星星和地上的人遵循着同样的运行规则。我们的文明智慧是不差的，点错了科技树实在是可惜啊。

1900-2049年的农历数据表,5个16进制数，共20bit

- 前4位，在这一年是润年时才有意义，它代表这年润月的大小月，为1则润大月，为0则润小月。
- 中间12位，即4bit，每位代表一个月，为1则为大月，为0则为小月。
- 最后4位，即8，代表这一年的润月月份，为0则不润。首4位要与末4位搭配使用

```
0x04bd8,0x04ae0,0x0a570,0x054d5,0x0d260,0x0d950,0x16554,0x056a0,0x09ad0,0x055d2,
0x04ae0,0x0a5b6,0x0a4d0,0x0d250,0x1d255,0x0b540,0x0d6a0,0x0ada2,0x095b0,0x14977,
0x04970,0x0a4b0,0x0b4b5,0x06a50,0x06d40,0x1ab54,0x02b60,0x09570,0x052f2,0x04970,
0x06566,0x0d4a0,0x0ea50,0x06e95,0x05ad0,0x02b60,0x186e3,0x092e0,0x1c8d7,0x0c950,
0x0d4a0,0x1d8a6,0x0b550,0x056a0,0x1a5b4,0x025d0,0x092d0,0x0d2b2,0x0a950,0x0b557,
0x06ca0,0x0b550,0x15355,0x04da0,0x0a5d0,0x14573,0x052d0,0x0a9a8,0x0e950,0x06aa0,
0x0aea6,0x0ab50,0x04b60,0x0aae4,0x0a570,0x05260,0x0f263,0x0d950,0x05b57,0x056a0,
0x096d0,0x04dd5,0x04ad0,0x0a4d0,0x0d4d4,0x0d250,0x0d558,0x0b540,0x0b5a0,0x195a6,
0x095b0,0x049b0,0x0a974,0x0a4b0,0x0b27a,0x06a50,0x06d40,0x0af46,0x0ab60,0x09570,
0x04af5,0x04970,0x064b0,0x074a3,0x0ea50,0x06b58,0x055c0,0x0ab60,0x096d5,0x092e0,
0x0c960,0x0d954,0x0d4a0,0x0da50,0x07552,0x056a0,0x0abb7,0x025d0,0x092d0,0x0cab5,
0x0a950,0x0b4a0,0x0baa4,0x0ad50,0x055d9,0x04ba0,0x0a5b0,0x15176,0x052b0,0x0a930,
0x07954,0x06aa0,0x0ad50,0x05b52,0x04b60,0x0a6e6,0x0a4e0,0x0d260,0x0ea65,0x0d530,
0x05aa0,0x076a3,0x096d0,0x04bd7,0x04ad0,0x0a4d0,0x1d0b6,0x0d250,0x0d520,0x0dd45,
0x0b5a0,0x056d0,0x055b2,0x049b0,0x0a577,0x0a4b0,0x0aa50,0x1b255,0x06d20,0x0ada0
```

#### 二十四节气

24节气是太阳历，其定义以地球在绕日轨道上的位置为基准，冬至即太阳照射到地球南回归线上的时刻，夏至为北回归线，春分秋分就是太阳直射赤道的时刻，所以二十四节气的是有精确的时刻，这个时刻所在的那一天便是节气的日期。由于地球日和公转回归年的差异，这个日期会在一两天内摇摆。

节气的定法有两种。古代历法采用的称为"恒气"，即按时间把一年等分为24份，每一节气平均得15天有余，所以又称"平气"。现代农历采用的称为"定气"，即按地球在轨道上的位置为标准，一周360°，两节气之间相隔15°。由于地球的公转轨道其实是椭圆，冬至时地球位于近日点附近，运动速度较快，因而太阳在黄道上移动15°的时间不到15天。夏至前后的情况正好相反，太阳在黄道上移动较慢，一个节气达16天之多。采用定气时可以保证春、秋两分必然在昼夜平分的那两天，可以更好的体现节气对季节的区分作用。

定义24个节气与第一个节气所相差的时间长度（分钟），然后以一个确定的时刻作为标准，如1900年1月6日 2:05:00AM 是小寒，

```python
solarTerm = ["小寒", "大寒", "立春", "雨水", "惊蛰", "春分", "清明", "谷雨", "立夏", "小满", "芒种", "夏至", "小暑", "大暑", "立秋", "处暑", "白露", "秋分", "寒露", "霜降", "立冬", "小雪", "大雪", "冬至"]
sTermInfo = [0, 21208, 42467, 63836, 85337, 107014, 128867, 150921, 173149, 195551, 218072, 240693, 263343, 285989, 308563, 331033, 353350, 375494, 397447, 419210, 440795, 462224, 483532, 504758]
```

上面已经说过一个公转回归年为365.2422天即 525948.768分钟，由于节气均不在元旦日期附近，即使由于闰年相差一两天也不会跨年，直接以年份和基准节气时间（本例中的1900年1月6日 2:05:00AM）的间隔*525948.768 数加上当前节气时间间隔数便是本年24节气的精确时间。

#### 干支纪年

未完待续



